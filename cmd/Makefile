.POSIX:
CC      = cc
CFLAGS  = -std=gnu99 -O2 -Wall -Wextra -pedantic -l iuab
LD      = $(CC)
LDFLAGS = -l iuab

INSTALL = install -D

BUILDDIR = build
DESTDIR  =
PREFIX   = /usr/local
BINDIR   = /bin
prefix   = $(DESTDIR)$(PREFIX)
bindir   = $(prefix)$(BINDIR)

TARGET = i-use-arch-btw

OBJECTS = src/log.o src/main.o src/options.o src/timer.o

all: $(BUILDDIR)/$(TARGET)

$(BUILDDIR):
	@echo "  MKDIR   $@"
	@mkdir -p $@

$(BUILDDIR)/$(TARGET): $(BUILDDIR) $(OBJECTS)
	@echo "  LD      $@"
	@$(LD) $(LDFLAGS) -o $@ $(OBJECTS)

.c.o:
	@echo "  CC      $@"
	@$(CC) $(CFLAGS) -c -o $@ $<

install: $(BUILDDIR)/$(TARGET)
	@echo "  INSTALL $(bindir)/$(TARGET)"
	@$(INSTALL) $< $(bindir)/$(TARGET)

uninstall:
	@echo "  RM      $(bindir)/$(TARGET)"
	@rm -f $(bindir)/$(TARGET)

depend:
	@for file in src/*.c; do \
		$(CC) $(CFLAGS) -MM -MT "$${file%.c}.o" "$$file"; \
	done

clean:
	@echo "  CLEAN"
	@rm -rf $(BUILDDIR) src/*.o

# Dependencies (generated by `make depend`)
src/log.o: src/log.c src/log.h
src/main.o: src/main.c src/log.h src/options.h src/timer.h src/version.h
src/options.o: src/options.c src/options.h
src/timer.o: src/timer.c src/timer.h src/log.h
